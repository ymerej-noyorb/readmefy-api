# TODO: Move this configuration in a dedicated repository and add healthcheck for every containers
services:
  readmefy-app:
    build: ../readmefy-app
    container_name: readmefy-app
    volumes:
      - ../readmefy-app:/readmefy-app
      - /readmefy-app/node_modules
    networks:
      - readmefy-network

  readmefy-api:
    build: .
    container_name: readmefy-api
    volumes:
      - .:/readmefy-api
      - /readmefy-api/node_modules
    depends_on:
      - readmefy-db
    environment:
      - READMEFY_ENV=${READMEFY_ENV}
      - READMEFY_TOKEN=${READMEFY_TOKEN}
      - READMEFY_SECRET=${READMEFY_SECRET}
      - READMEFY_USER=${READMEFY_USER}
      - READMEFY_PASSWORD=${READMEFY_PASSWORD}
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
    networks:
      - readmefy-network

  # TODO: Create his own Dockerfile in new repository
  readmefy-proxy:
    image: nginx:1.26
    container_name: readmefy-proxy
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - readmefy-app
      - readmefy-api
    networks:
      - readmefy-network

  # TODO: Create his own Dockerfile in new repository
  readmefy-db:
    image: mysql:8.4
    container_name: readmefy-db
    environment:
      MYSQL_ROOT_PASSWORD: ${READMEFY_ROOT_PASSWORD}
      MYSQL_DATABASE: ${READMEFY_DATABASE}
      MYSQL_USER: ${READMEFY_USER}
      MYSQL_PASSWORD: ${READMEFY_PASSWORD}
    networks:
      - readmefy-network

networks:
  readmefy-network:
    driver: bridge
